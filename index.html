<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Moonfish&#39;s blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Moonfish&#39;s blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Moonfish&#39;s blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Moonfish's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Moonfish's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/18/IAST简述/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="moonfish">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moonfish's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/18/IAST简述/" itemprop="url">IAST简述</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-18T00:56:16+08:00">
                2017-12-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>IAST（Interactive Application Security Testing)-交互式应用安全测试。2012年由gartner公司提出，其博客 <a href="https://blogs.gartner.com/neil_macdonald/2012/01/30/interactive-application-security-testing/" target="_blank" rel="noopener">Interactive Application Security Testing</a> 对IAST的定义是：<br><code>Specifically, we are looking for ways that application security testing solutions combine dynamic and static techniques to improve the overall quality of the testing results. The information gathered by this instrumentation agent gives the hybrid solution an inside-out view that complements the outside-in view of a purely DAST solution — for example, identifying the specific line of code where a security vulnerability occurred, or providing detailed visibility into code coverage.</code></p>
<p>大意是结合动态（DAST）和静态(SAST)扫描的方式提高扫描结果的质量.通过插桩的方式收集应用内部的信息，从而弥补纯DAST扫描的不足，比如确定漏洞发生的代码行数或者提供一个详细的可视化的代码范围。<br>IAST = DAST(Dynamic Application Security Testing) + SAST(Static Application Security Testing)</p>
<p>DAST：动态扫描，即黑盒扫描，如AWVS，APPSCAN，检测运行时的应用<br><img src="/2017/12/18/IAST简述/dast.png" alt=""><br>SAST: 静态扫描，即白盒扫描，如RIPS，Fortify，代码层面的漏洞检测<br><img src="/2017/12/18/IAST简述/sast.png" alt=""></p>
<h3 id="IAST的两种模式"><a href="#IAST的两种模式" class="headerlink" title="IAST的两种模式"></a>IAST的两种模式</h3><h4 id="Active-IAST-Induced-IAST"><a href="#Active-IAST-Induced-IAST" class="headerlink" title="Active IAST(Induced IAST)"></a>Active IAST(Induced IAST)</h4><p>这种模式的检测能力需要一个外部的扫描器去触发应用内部的agent，简单来说，它可以检测到DAST检测不到的漏洞。比如说，一个无法回显或无法被DAST检测的漏洞可以被Active IAST发现，然后与DAST进行交互，从而判断攻击是否成功，同时通过追踪变量，精确定位漏洞代码的位置。不过这个模式有个缺点，DAST扫描去触发漏洞需要一定的时间，同时黑盒扫描器也需要去配置和维护，所以并不推荐在CI\CD 和 DevOps环境中使用。<br><img src="/2017/12/18/IAST简述/active.png" alt=""><br>相关安全产品<br><img src="/2017/12/18/IAST简述/active-iast.png" alt=""><br>AWVS acusensor<br><img src="/2017/12/18/IAST简述/awvs.png" alt=""><br>BURP infiltrator<br><img src="/2017/12/18/IAST简述/infiltrator_issue.png" alt=""></p>
<h4 id="Passive-IAST-Self-Sufficient"><a href="#Passive-IAST-Self-Sufficient" class="headerlink" title="Passive IAST(Self Sufficient)"></a>Passive IAST(Self Sufficient)</h4><p>Passive IAST 也需要一个插桩到测试应用中的agent，但这个agent是独立的，可以在应用运行时被动地监听和分析代码，通过扫描运行中的代码查找漏洞。Passive IAST并不攻击应用，所以它并不会干扰其他的安全测试活动，只要普通的业务测试（手工或自动的访问）就可以进行安全测试。当有人（或工具）对应用进行测试时，IAST会分析数据流，从而找到潜在的漏洞，并上报到控制台。<br><img src="/2017/12/18/IAST简述/passive.png" alt=""><br>360skywolf<br><img src="/2017/12/18/IAST简述/skywolf.png" alt=""><br>contrast security<br><img src="/2017/12/18/IAST简述/contrast.png" alt=""></p>
<h3 id="agent收集的信息"><a href="#agent收集的信息" class="headerlink" title="agent收集的信息"></a>agent收集的信息</h3><ul>
<li>请求数据和返回数据</li>
<li>代码执行中的参数传递</li>
<li>数据库查询（如ODBC），目录查询（如LDAP），文件系统权限</li>
<li>运行时字符的操作（字符合并分割）</li>
<li>监听内存中特定的值，识别受污染的输入</li>
<li>三方库的使用</li>
<li>对外部应用程序或服务的调用</li>
<li>特定代码行的执行</li>
<li>……..</li>
</ul>
<h3 id="IAST的特点"><a href="#IAST的特点" class="headerlink" title="IAST的特点"></a>IAST的特点</h3><ul>
<li>误报率低<br>IAST定位到漏洞代码行数，从而清除误报。</li>
<li>测试时间短<br>探针可以跟踪变量参数的传递（数据库、文件操作等），然后控制台针对这些操作做出相关的攻击测试</li>
<li>支持JAVA,.NET,Node.js,PHP,Python等语言开发的WEB应用</li>
<li>即时反馈</li>
</ul>
<p>参考：<br><a href="https://blog.secodis.com/2015/11/26/the-emerge-of-iast/" target="_blank" rel="noopener">https://blog.secodis.com/2015/11/26/the-emerge-of-iast/</a><br><a href="https://dzone.com/articles/ciso-how-to-own-your-applications-security" target="_blank" rel="noopener">https://dzone.com/articles/ciso-how-to-own-your-applications-security</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/16/Host-Header欺骗在密码找回中的利用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="moonfish">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Moonfish's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/16/Host-Header欺骗在密码找回中的利用/" itemprop="url">Host Header欺骗在密码找回中的利用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-16T21:48:00+08:00">
                2017-12-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>首先这是一篇译文，分享了一个找回密码功能中利用$_SERVER[‘HTTP_HOST’]窃取token的姿势，本来我以为是email header injection，后来发现不是。雨神在他的blog <a href="http://www.yulegeyu.com/2017/04/24/%E4%B8%BA%E4%BB%80%E4%B9%88$_SERVER[&#39;HTTP_HOST&#39;]%E6%9C%89%E6%97%B6%E6%98%AF%E4%B8%8D%E5%8F%AF%E6%8E%A7%E7%9A%84%E3%80%82/" target="_blank" rel="noopener">为什么$_SERVER[‘HTTP_HOST’]有时是不可控的 </a>中就提到$_SERVER[‘HTTP_HOST’]是可控的<br><code>一些同学会以为HTTP的联机就是靠包里的HOST header来连接的,所以会认为如果修改掉包里的HOST, 那么就连接不到目标服务器,所以是不可控的。
其实HTTP的联机与包里的HOST并没有啥关系, HTTP的联机是TCP/IP建立的, 所以修改掉HOST HEADER并不会把包丢到另外一个服务器上。</code><br>当应用使用$_SERVER[‘HTTP_HOST’]获取网站URL并拼接到找回密码的链接当中，漏洞就会发生。</p>
<p>当你使用网站密码重置功能，由于你的网站URL可能在将来会改变，所以你想动态地生成一个邮箱找回密码的链接来匹配服务器的URL。没问题，你Google PHP中获取服务器URL的方法，找到了<a href="https://stackoverflow.com/questions/6768793/get-the-full-url-in-php" target="_blank" rel="noopener">Get the full URL in PHP</a>。你想都不想就添加<code>$_SERVER[&#39;HTTP_HOST&#39;]</code>到你的代码中。<br>Host header 是客户端提供的，意味着攻击者可以将他们自己的网址写到重置密码的邮件当中，威胁任意用户的账户安全。下面是一个攻击场景：</p>
<ol>
<li>攻击者确认目标用户邮箱地址</li>
<li>攻击者将重置密码请求中的host header设置成他们自己的网址</li>
<li>目标用户会接收到如下的邮件<br><img src="/2017/12/16/Host-Header欺骗在密码找回中的利用/post4-screenshot1.png" alt="image"></li>
<li>目标用户出于对公司的信任，点击了这个重置链接。由于这个链接是由host header生成的，会指向攻击者的网站。当目标用户访问了这个网站，他们的密码重置token也会被发给攻击者。</li>
<li>此时攻击者可以使用目标用户的token重置他们的密码<br>不幸的是，这种攻击并非纯理论，我在过去的几个月里发现了4个漏洞。</li>
</ol>
<h2 id="案例-Mavenlink"><a href="#案例-Mavenlink" class="headerlink" title="案例 - Mavenlink"></a>案例 - Mavenlink</h2><p>我决定在Mavenlink上测试这个漏洞，他们的项目地址是<a href="https://hackerone.com/mavenlink" target="_blank" rel="noopener">public HackerOne program</a><br>Mavenlink 允许用户注册一个mavenlink.com的子域名去展示他们的内容，所以他们需要一个方法去动态地决定公司的子域名。<br>我迅速地发现我可以为将host header 设置为mavenlink.com的任意子域名，这会在邮件中得到证明。然而，从mavenlink.com更改域名将会返回一个错误，而不是发送一个邮件。<br>首先，这看起来比较安全。我没有办法插入我自己的域名。但是我可以添加一个随机的mavenlink.com的子域名，但是这会被定向到正确的页面。<br>然后我开始测试特殊字符。经过多次尝试之后我成功了，服务器接受header中的一个问号，所以我可以将？放在我的域名后面，生成下面的链接<br>    Host: example.com?mavenlink.com<br>这可以让我从用户的邮件中盗取密码重置token<br><img src="/2017/12/16/Host-Header欺骗在密码找回中的利用/post4-screenshot2.png" alt="image"><br>报告地址：<a href="https://hackerone.com/reports/281575." target="_blank" rel="noopener">https://hackerone.com/reports/281575</a></p>
<p>结论：</p>
<p>发送密码重置邮件时，不要信任Host header。同时你在任何情况下也不要信任它。相反，如果你需要对一个动态的URL进行解析，最好的方法是将host作为一个服务端变量储存。</p>
<p>原文：<a href="https://lightningsecurity.io/blog/host-header-injection/" target="_blank" rel="noopener">https://lightningsecurity.io/blog/host-header-injection/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">moonfish</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">Artikel</span>
                </a>
              </div>
            

            

            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">moonfish</span>

  
</div>


  <div class="powered-by">Erstellt mit  <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
